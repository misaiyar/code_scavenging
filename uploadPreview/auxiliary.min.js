function JPEGEncoder(e){function a(e){for(var a=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],r=0;64>r;r++){var t=M((a[r]*e+50)/100);1>t?t=1:t>255&&(t=255),C[F[r]]=t}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;64>o;o++){var i=M((n[o]*e+50)/100);1>i?i=1:i>255&&(i=255),x[F[o]]=i}for(var c=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],s=0,d=0;8>d;d++)for(var h=0;8>h;h++)k[s]=1/(C[F[s]]*c[d]*c[h]*8),R[s]=1/(x[F[s]]*c[d]*c[h]*8),s++}function r(e,a){for(var r=0,t=0,n=new Array,o=1;16>=o;o++){for(var i=1;i<=e[o];i++)n[a[t]]=[],n[a[t]][0]=r,n[a[t]][1]=o,t++,r++;r*=2}return n}function t(){y=r($,H),I=r(V,Q),p=r(J,K),L=r(z,G)}function n(){for(var e=1,a=2,r=1;15>=r;r++){for(var t=e;a>t;t++)S[32767+t]=r,U[32767+t]=[],U[32767+t][1]=r,U[32767+t][0]=t;for(var n=-(a-1);-e>=n;n++)S[32767+n]=r,U[32767+n]=[],U[32767+n][1]=r,U[32767+n][0]=a-1+n;e<<=1,a<<=1}}function o(){for(var e=0;256>e;e++)q[e]=19595*e,q[e+256>>0]=38470*e,q[e+512>>0]=7471*e+32768,q[e+768>>0]=-11059*e,q[e+1024>>0]=-21709*e,q[e+1280>>0]=32768*e+8421375,q[e+1536>>0]=-27439*e,q[e+1792>>0]=-5329*e}function i(e){for(var a=e[0],r=e[1]-1;r>=0;)a&1<<r&&(T|=1<<O),r--,O--,0>O&&(255==T?(c(255),c(0)):c(T),O=7,T=0)}function c(e){D.push(W[e])}function s(e){c(e>>8&255),c(255&e)}function d(e,a){var r,t,n,o,i,c,s,d,h,v=0;const f=8,g=64;for(h=0;f>h;++h){r=e[v],t=e[v+1],n=e[v+2],o=e[v+3],i=e[v+4],c=e[v+5],s=e[v+6],d=e[v+7];var l=r+d,m=r-d,u=t+s,w=t-s,b=n+c,y=n-c,I=o+i,p=o-i,L=l+I,A=l-I,M=u+b,C=u-b;e[v]=L+M,e[v+4]=L-M;var x=.707106781*(C+A);e[v+2]=A+x,e[v+6]=A-x,L=p+y,M=y+w,C=w+m;var k=.382683433*(L-C),R=.5411961*L+k,U=1.306562965*C+k,S=.707106781*M,P=m+S,D=m-S;e[v+5]=D+R,e[v+3]=D-R,e[v+1]=P+U,e[v+7]=P-U,v+=8}for(v=0,h=0;f>h;++h){r=e[v],t=e[v+8],n=e[v+16],o=e[v+24],i=e[v+32],c=e[v+40],s=e[v+48],d=e[v+56];var T=r+d,O=r-d,j=t+s,_=t-s,B=n+c,W=n-c,q=o+i,F=o-i,$=T+q,H=T-q,J=j+B,K=j-B;e[v]=$+J,e[v+32]=$-J;var V=.707106781*(K+H);e[v+16]=H+V,e[v+48]=H-V,$=F+W,J=W+_,K=_+O;var Q=.382683433*($-K),z=.5411961*$+Q,G=1.306562965*K+Q,N=.707106781*J,X=O+N,Y=O-N;e[v+40]=Y+z,e[v+24]=Y-z,e[v+8]=X+G,e[v+56]=X-G,v++}var Z;for(h=0;g>h;++h)Z=e[h]*a[h],E[h]=Z>0?Z+.5|0:Z-.5|0;return E}function h(){s(65504),s(16),c(74),c(70),c(73),c(70),c(0),c(1),c(1),c(0),s(1),s(1),c(0),c(0)}function v(e,a){s(65472),s(17),c(8),s(a),s(e),c(3),c(1),c(17),c(0),c(2),c(17),c(1),c(3),c(17),c(1)}function f(){s(65499),s(132),c(0);for(var e=0;64>e;e++)c(C[e]);c(1);for(var a=0;64>a;a++)c(x[a])}function g(){s(65476),s(418),c(0);for(var e=0;16>e;e++)c($[e+1]);for(var a=0;11>=a;a++)c(H[a]);c(16);for(var r=0;16>r;r++)c(J[r+1]);for(var t=0;161>=t;t++)c(K[t]);c(1);for(var n=0;16>n;n++)c(V[n+1]);for(var o=0;11>=o;o++)c(Q[o]);c(17);for(var i=0;16>i;i++)c(z[i+1]);for(var d=0;161>=d;d++)c(G[d])}function l(){s(65498),s(12),c(3),c(1),c(0),c(2),c(17),c(3),c(17),c(0),c(63),c(0)}function m(e,a,r,t,n){var o,c=n[0],s=n[240];const h=16,v=63,f=64;for(var g=d(e,a),l=0;f>l;++l)P[F[l]]=g[l];var m=P[0]-r;r=P[0],0==m?i(t[0]):(o=32767+m,i(t[S[o]]),i(U[o]));for(var u=63;u>0&&0==P[u];u--);if(0==u)return i(c),r;for(var w,b=1;u>=b;){for(var y=b;0==P[b]&&u>=b;++b);var I=b-y;if(I>=h){w=I>>4;for(var p=1;w>=p;++p)i(s);I=15&I}o=32767+P[b],i(n[(I<<4)+S[o]]),i(U[o]),b++}return u!=v&&i(c),r}function u(){for(var e=String.fromCharCode,a=0;256>a;a++)W[a]=e(a)}function w(e){if(0>=e&&(e=1),e>100&&(e=100),A!=e){var r=0;r=Math.floor(50>e?5e3/e:200-2*e),a(r),A=e,console.log("Quality set to: "+e+"%")}}function b(){var a=(new Date).getTime();e||(e=50),u(),t(),n(),o(),w(e);var r=(new Date).getTime()-a;console.log("Initialization "+r+"ms")}var y,I,p,L,A,M=(Math.round,Math.floor),C=new Array(64),x=new Array(64),k=new Array(64),R=new Array(64),U=new Array(65535),S=new Array(65535),E=new Array(64),P=new Array(64),D=[],T=0,O=7,j=new Array(64),_=new Array(64),B=new Array(64),W=new Array(256),q=new Array(2048),F=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],$=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],H=[0,1,2,3,4,5,6,7,8,9,10,11],J=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],K=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],V=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Q=[0,1,2,3,4,5,6,7,8,9,10,11],z=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],G=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,a){var r=(new Date).getTime();a&&w(a),D=new Array,T=0,O=7,s(65496),h(),f(),v(e.width,e.height),g(),l();var t=0,n=0,o=0;T=0,O=7,this.encode.displayName="_encode_";for(var c,d,u,b,A,M,C,x,U,S=e.data,E=e.width,P=e.height,W=4*E,F=0;P>F;){for(c=0;W>c;){for(A=W*F+c,M=A,C=-1,x=0,U=0;64>U;U++)x=U>>3,C=4*(7&U),M=A+x*W+C,F+x>=P&&(M-=W*(F+1+x-P)),c+C>=W&&(M-=c+C-W+4),d=S[M++],u=S[M++],b=S[M++],j[U]=(q[d]+q[u+256>>0]+q[b+512>>0]>>16)-128,_[U]=(q[d+768>>0]+q[u+1024>>0]+q[b+1280>>0]>>16)-128,B[U]=(q[d+1280>>0]+q[u+1536>>0]+q[b+1792>>0]>>16)-128;t=m(j,k,t,y,p),n=m(_,R,n,I,L),o=m(B,R,o,I,L),c+=32}F+=8}if(O>=0){var $=[];$[1]=O+1,$[0]=(1<<O+1)-1,i($)}s(65497);var H="data:image/jpeg;base64,"+btoa(D.join(""));D=[];var J=(new Date).getTime()-r;return console.log("Encoding time: "+J+"ms"),H},b()}function detectSubsampling(e){var a=e.naturalWidth,r=e.naturalHeight;if(a*r>1048576){var t=document.createElement("canvas");t.width=t.height=1;var n=t.getContext("2d");return n.drawImage(e,-a+1,0),0===n.getImageData(0,0,1,1).data[3]}return!1}function detectVerticalSquash(e,a,r){var t=document.createElement("canvas");t.width=1,t.height=r;var n=t.getContext("2d");n.drawImage(e,0,0);for(var o=n.getImageData(0,0,1,r).data,i=0,c=r,s=r;s>i;){var d=o[4*(s-1)+3];0===d?c=s:i=s,s=c+i>>1}var h=s/r;return 0===h?1:h}function renderImageToDataURL(e,a,r){var t=document.createElement("canvas");return renderImageToCanvas(e,t,a,r),t.toDataURL("image/jpeg",a.quality||.8)}function renderImageToCanvas(e,a,r,t){var n=e.naturalWidth,o=e.naturalHeight,i=r.width,c=r.height,s=a.getContext("2d");s.save(),transformCoordinate(a,i,c,r.orientation);var d=detectSubsampling(e);d&&(n/=2,o/=2);var h=1024,v=document.createElement("canvas");v.width=v.height=h;for(var f=v.getContext("2d"),g=t?detectVerticalSquash(e,n,o):1,l=Math.ceil(h*i/n),m=Math.ceil(h*c/o/g),u=0,w=0;o>u;){for(var b=0,y=0;n>b;)f.clearRect(0,0,h,h),f.drawImage(e,-b,-u),s.drawImage(v,0,0,h,h,y,w,l,m),b+=h,y+=l;u+=h,w+=m}s.restore(),v=f=null}function transformCoordinate(e,a,r,t){switch(t){case 5:case 6:case 7:case 8:e.width=r,e.height=a;break;default:e.width=a,e.height=r}var n=e.getContext("2d");switch(t){case 2:n.translate(a,0),n.scale(-1,1);break;case 3:n.translate(a,r),n.rotate(Math.PI);break;case 4:n.translate(0,r),n.scale(1,-1);break;case 5:n.rotate(.5*Math.PI),n.scale(1,-1);break;case 6:n.rotate(.5*Math.PI),n.translate(0,-r);break;case 7:n.rotate(.5*Math.PI),n.translate(a,-r),n.scale(-1,1);break;case 8:n.rotate(-.5*Math.PI),n.translate(-a,0)}}function getURLObject(){return $.browser.uc&&"8.4"==$.browser.version?null:window.URL||window.webkitURL||window.mozURL}function getImageURL(e,a){if(e instanceof Blob){var r=getURLObject();if(r)a(r.createObjectURL(e));else{var t=new FileReader;t.onload=function(e){a(e.target.result)},t.onerror=function(){a(null)},t.readAsDataURL(e)}}}function MegaPixImage(e){var a=this;getImageURL(e,function(r){if(!r)throw Error("can't create url");var t=new Image;if(t.src=r,a.blob=e,e=t,!e.naturalWidth&&!e.naturalHeight){var n=a;e.onload=function(){var e=n.imageLoadListeners;if(e){n.imageLoadListeners=null;for(var a=0,r=e.length;r>a;a++)e[a]()}},a.imageLoadListeners=[]}a.srcImage=e})}function getImageMeta(e,a){var r=new FileReader,t=null,n=null;r.onload=function(r){if("image/jpeg"===e.type)try{n=new JpegMeta.JpegFile(r.target.result,e.name)}catch(o){t=o}a(t,n)},r.onerror=function(e){a(e.target.error,n)},r.readAsBinaryString(e)}function compress(e,a,r){var t=new MegaPixImage(e),n=$.extend({type:"image/jpeg",maxHeight:800,maxWidth:600,quality:.8},a);EXIF.getData(e,function(){var e=EXIF.getAllTags(this).Orientation;e&&(n=$.extend({orientation:e},n));var o=document.createElement("canvas");t.onrender=function(){var e="";if($.os.android&&"image/jpeg"==n.type){var t=o.getContext("2d"),i=t.getImageData(0,0,o.width,o.height),c=new JPEGEncoder(100*n.quality);e=c.encode(i),c=null}else e=o.toDataURL(a.type,a.quality);r(e)},t.render(o,n)})}function detect(e){var a=this.os={},r=this.browser={},t=e.match(/WebKit\/([\d.]+)/),n=e.match(/(Android)\s+([\d.]+)/),o=e.match(/(iPad).*OS\s([\d_]+)/),i=!o&&e.match(/(iPhone\sOS)\s([\d_]+)/),c=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),s=c&&e.match(/TouchPad/),d=e.match(/Kindle\/([\d.]+)/),h=e.match(/Silk\/([\d._]+)/),v=e.match(/(BlackBerry).*Version\/([\d.]+)/),f=e.match(/(BB10).*Version\/([\d.]+)/),g=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),l=e.match(/PlayBook/),m=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),u=e.match(/Firefox\/([\d.]+)/),w=e.match(/MicroMessenger\/([\d\.]+)/),b=e.match(/Safari\/([\d.]+)/),y=e.match(/\s?UC|JUC|UCWEB/),I=e.match(/MQQBrowser/);if((r.webkit=!!t)&&(r.version=t[1]),n&&(a.android=!0,a.version=n[2]),i&&(a.ios=a.iphone=!0,a.version=i[2].replace(/_/g,".")),o&&(a.ios=a.ipad=!0,a.version=o[2].replace(/_/g,".")),c&&(a.webos=!0,a.version=c[2]),s&&(a.touchpad=!0),v&&(a.blackberry=!0,a.version=v[2]),f&&(a.bb10=!0,a.version=f[2]),g&&(a.rimtabletos=!0,a.version=g[2]),l&&(r.playbook=!0),d&&(a.kindle=!0,a.version=d[1]),h&&(r.silk=!0,r.version=h[1]),!h&&a.android&&e.match(/Kindle Fire/)&&(r.silk=!0),m&&(r.chrome=!0,r.version=m[1]),u&&(r.firefox=!0,r.version=u[1]),w&&(r.wechat=!0,r.version=w[1]),y){r.uc=!0,r.version="8.6";var p=0,L=navigator.userAgent,A=L.match(/AppleWebKit\/([\w\._]+)/);A&&(p=A[1]),["530","530+"].indexOf(p)>=0&&(r.version="8.4")}I&&(r.qq=!0,r.version="4.2"),!b||I||y||w||m||(r.safari=!0),a.tablet=!!(o||l||n&&!e.match(/Mobile/)||u&&e.match(/Tablet/)),a.phone=!(a.tablet||!(n||i||c||v||f||m&&e.match(/Android/)||m&&e.match(/CriOS\/([\d.]+)/)||u&&e.match(/Mobile/)))}MegaPixImage.prototype.render=function(e,a){if(this.imageLoadListeners){var r=this;return void this.imageLoadListeners.push(function(){r.render(e,a)})}a=a||{};var t=this.srcImage.naturalWidth,n=this.srcImage.naturalHeight,o=a.width,i=a.height,c=a.maxWidth,s=a.maxHeight,d=!this.blob||"image/jpeg"===this.blob.type;o&&!i?i=n*o/t<<0:i&&!o?o=t*i/n<<0:(o=t,i=n),c&&o>c&&(o=c,i=n*o/t<<0),s&&i>s&&(i=s,o=t*i/n<<0);var h={width:o,height:i};for(var v in a)h[v]=a[v];var f=e.tagName.toLowerCase();"img"===f?e.src=renderImageToDataURL(this.srcImage,h,d):"canvas"===f&&renderImageToCanvas(this.srcImage,e,h,d),"function"==typeof this.onrender&&this.onrender(e)},detect.call($,navigator.userAgent),$.__detect=detect;
